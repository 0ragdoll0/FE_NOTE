# HTTP/1.0

## 请求和回应
通信内容=头部（ASCII 码）+数据（各类格式）

### 请求
* GET/POST/HEAD / HTTP/1.0
* User-Agent
> 客户端信息
* Accept
> 可接收数据格式
* Accept-Encoding
> 可接收的压缩方式

### 回应
头信息 + 一个空行（\r\n） + 数据
* 协议版本 + 状态码（status code） + 状态描述
* Content-Type    
> 返回数据的格式（MIME type）（+;编码方式）      
> 例：Content-Type: text/html; charset=utf-8
* Content-Encoding
> 数据压缩方式

## 缺点
每个TCP连接只能发送一个请求。如果需要请求其他资源需要重新建立一个TCP连接，而TCP连接的建立需要客户端和服务器端三次握手，成本较高。

# HTTP/1.1
## 持久连接
TCP连接默认不关闭，进行复用，当客户端和服务器端发现对方一段时间没有活动，就可以主动关闭连接。

## 管道机制
客户端可以同时发送多个请求，但服务器按请求发出的顺序进行回应

## Transfer-Encoding: chunked
> "流模式"（stream）取代"缓存模式"（buffer）     
> 每个非空的数据块之前，会有一个16进制的数值，表示这个块的长度。最后是一个大小为0的块，就表示本次回应的数据发送完了。

## 新增
* 方法：PUT、PATCH、HEAD、 OPTIONS、DELETE
* 字段：Host（以将请求发往同一台服务器上的不同网站）

## 缺点
Head-of-line blocking：前面回应速度影响队列中后面的回应

# HTTP/2
**HTTP/2 协议只有在 HTTPS 环境才会生效**   
> 以下均为相对于HTTP/1.1改进部分：
## 二进制协议
信息头和数据内容均为二进制

## 多工
TCP连接进行复用，回应可以不按顺序，避免队头堵塞

## 数据流
> 1. 由于回应可以不按顺序且连接复用，需要在一个连接中区分每个回应的数据包->每个回应的数据包称为一个数据流，用数据流ID来区分。
> 2. 客户端或服务器端可发送RST_STREAM中断数据流，且不中断TCP链接   
> 3. 客户端可指定数据流优先级

## 头信息压缩
HTTP 协议不带有状态，每次请求都必须附上所有信息。有一些发送的头信息，例如cookie和user agent每次重复，浪费带宽。          
> 解决方法：     
> 1. 头信息使用gzip或compress压缩后再发送     
> 2. 客户端和服务器同时维护一张头信息表，所有字段都会存入这个表，生成一个索引号，以后就不发送同样字段了，只发送索引号

## 服务器推送
服务器未经请求，主动向客户端发送资源

# 常见状态码
[状态码详解](http://www.cnblogs.com/TankXiao/archive/2013/01/08/2818542.html#code206)
## 2XX成功
请求已成功被服务器接收、理解、并接受
* 200 OK:服务器成功处理了请求
* 204 Not Content：Response中包含一些Header和一个状态行， 但不包括实体的主题内容（没有response body）

## 3XX重定向状态
告诉浏览器客户端，它们访问的资源已被移动， Web服务器发送一个重定向状态码和一个可选的Location Header, 告诉客户端新的资源地址在哪。
浏览器客户端会自动用Location中提供的地址，重新发送新的Request。
* 301 Moved Permanently:永久移除（SEO中会将返回的Location Header当做唯一有效目标）
* 302 Found：临时移除
* 304 Not Modified：客户的缓存资源是最新的， 要客户端使用缓存

## 4XX客户端错误状态
客户端发送了一些服务器无法处理的东西，比如格式错误的Request, 或者最常见的是， 请求一个不存在的URL。
* 400 Bad Request：请求错误
* 401 Unauthorized：缺少客户端认证
* 403 Forbidden：请求被服务器拒绝
* 404 Not Found：未找到资源

## 5XX服务器端错误状态
* 500 Internal Server Error:内部服务器错误
* 501 Not Implement:客户端发起的请求超出服务器的能力范围(比如，使用了服务器不支持的请求方法)
* 502 Bad Gateway:代理使用的服务器遇到了上游的无效响应
* 503 Service Unavailable:服务器目前无法为请求提供服务，但过一段时间就可以恢复服务

# HTTPS
基于SSL(安全套接层)/TLS(传输安全层)
默认端口：443
## 步骤
1. 客户端发送：协议版本号，一个随机数，支持的加密方式      
2. 服务器端确认加密方法，返回数字证书和一个随机数            
3. 客户端确认数字证书有效，产生一个随机数，使用数字证书中的公钥对齐加密，将加密之后的内容发送给服务器端       
4. 服务器端利用私钥对收到的随机数解密      
5. 客户端和服务器端都利用三个随机数，使用之前约定的加密方法生成对话密钥（session key），对之后的对话进行加密

## 注意
1. 整个握手阶段明文传输，其中加密方式和两个随机数是可以获取的      
2. 客户端的第二个随机数为‘非对称加密’，公钥在数字证书中
3. 对话密钥对于对话进行对称加密，速度快

# session恢复
1. session ID。  发送后使用之前生成的对话密钥（单个服务器）
2. session ticket 支持多个服务器
